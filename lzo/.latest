#!/bin/bash

set -eu -o pipefail ; export SHELLOPTS

version=$(
  curl -s https://www.oberhumer.com/opensource/lzo/download/ \
    | grep -E 'href="lzo-[^"]+.tar.gz"' \
    | sed -E 's/^.+href="lzo-([^"]+).tar.gz".+$/\1/' \
    | sort -rV \
    | head -n1
)

sha1=$(
  curl \
    -s \
    https://www.oberhumer.com/opensource/lzo/ \
    | grep -E 'SHA1: ' \
    | sed -E 's/^.+SHA1:\s+([a-f0-9]{40}).+$/\1/' \
    | head -n1 \



cat <<EOF
<?xml version="1.0" encoding="utf-8"?>
<metalink xmlns="urn:ietf:params:xml:ns:metalink">
  <file name="lzo-${VERSION}.tar.gz">
    <hash type="sha1">${sha1}</hash>
    <url>https://www.oberhumer.com/opensource/lzo/download/lzo-${VERSION}.tar.gz</url>
    <version>${version}</version>
  </file>
</metalink>
EOF
